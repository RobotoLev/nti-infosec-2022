# CODER SQUAD

Вчера нами был отправлен отчет по проделанной работе в сегменте DMZ.
Т.к. теперь отчеты требуется делить не по сегментам сети, а по частям задачи, этот отчет включает в себя реструктурированную информацию из предыдущего.

---
## Инвентаризация

Базовая инвентаризация проводилась по подсетям `10.12.2.0/24`, `10.12.3.0/24`, `10.12.4.0/24`, `10.12.239.0/24`, `10.12.240.0/24` при помощи утилиты `nmap`.
Результаты доступны в репозитории в папке `init_inv` в виде скриншотов (сервера организаторов не включены).

Итоговая инвентаризация (с учетом восстановленных сервисов) проводилась аналогично.
Результаты доступны в репозитории в папке `final_inv` в текстовом виде (сервера организаторов не включены). ***(TODO: Снова просканить и залить)***

### Linux 10.12.2.10
На первом хосте открыты 4 порта: 22 ssh, 80 и 8080 http-сервера, 3306 mysql.


---
## Расследование

См. в системе проведения соревнования

---
## Возврат контроля

### Linux 10.12.2.10 
На 80 порту обнаруживается простой сайт на Wordpress со стандартным доступом admin/admin. 

В админке уже установлен плагин для просмотра файлов, задаем ему корневую папку в `/` и получаем доступ ко всей файловой системе от имени `www-data`.
Загружаем веб-шелл, получаем доступ к командной строке от имени `www-data`.

При анализе логов и конфигов серверной части (`nginx` и `uwsgi`) находим Flask-приложение в `/home/user/SolarApp_back/` и его бекап в `/home/cadm/SolarApp_back/`.
Бекап readonly, у user-а имеем write-права.

В процессе аудита системы через `lastlog `были обнаружены входы на аккаунты `cadm` и `admin` с айпи адресов злоумышленника: `192.168.224.43`и `192.168.224.254` (см. `lastlog.png`)

### Windows 10.12.2.12
Эксплуатируем уязвимость CVE-2017-0143 и попадаем на машину.
`sudo msfconsole`

`use exploit/windows/smb/ms17_010_eternalblue`

`set RHOST 10.12.2.12`

`run`

Устранить ее можно закрыв порт 445 используя фаерволл или обновив Windows до последней версии.
`
netsh advfirewall firewall add rule dir=in action=block protocol=tcp localport=445 name=“Block_TCP-445”
` - блокирует порт 445

Находим уязвимый сервис `SLMail.exe` версии 5.5, которая уязвима к RCE при переполнении буфера.
Так как данный почтовый сервис больше не поддерживается разработчиками и версия 5.5 является последней и уязвимой.
Мы предлагаем удалить SLMail с коипьютера и заменить его на альтернативный почтвый сервер, к примеру бесплатный open-source hMailServer.

---
## Расшифровка файлов

### Linux 10.12.2.10
Python-приложение не работает, т.к. не имеет доступа к базе: в коде прописан доступ `root/root`, вероятно злоумышленник изменил доступы в базе.

Был восстановлен бекап базы данных из файла сохранения. Легитимный доступ для конечного пользователя к приложению восстановлен.

---
## Остановка распространения

### Linux 10.12.2.10
Меняем пароль админки Wordpress на `E1Jsw0)*(8dx`.

Исходное Python-приложение было уязвимо к SQL-инъекции. Приложение переписано, уязвимость исправлена. Исправленный код в `app.py`.

---
### Windows 10.12.2.11
Сканируем директории диобустом. Находим список директорий. Среди доступных видим директорию `/scripts`, где можно найти логи базы данных, а так же базувую инициализацию 6 юзеров.


